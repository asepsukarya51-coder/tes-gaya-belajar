<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>ðŸ§­ Tes 7 Gaya Belajar â€” SMA Pancawaluya (Siswa)</title>
<meta name="theme-color" content="#1565c0" />
<link rel="manifest" href='data:application/manifest+json,{"name":"Tes Gaya Belajar - SMA Pancawaluya","short_name":"GayaBelajar","start_url":"./index.html","display":"standalone","background_color":"#f2f8ff","theme_color":"#1565c0","description":"Tes singkat untuk mengetahui gaya belajar siswa (7 tipe)","icons":[{"src":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAAAAACPAi4CAAAAAnRSTlMAAHaTzTgAAABPSURBVHic7cExAQAAAMKg9U9tCF8gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIDnAAG3AAH8AAEFWnLrAAAAAElFTkSuQmCC","sizes":"192x192","type":"image/png"},{"src":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAAB5Gfe6AAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAABZJREFUeJxjYBgFo2AUjIJRMApGwSgYAABpGAG/yvvYYAAAAABJRU5ErkJggg==","sizes":"512x512","type":"image/png"}]}' />
<style>
:root{--bg:#f2f8ff;--primary:#1565c0}
html,body{height:100%}
body{margin:0;font-family:Inter,system-ui,Segoe UI,sans-serif;background:var(--bg);color:#222;padding:12px}
h1,h2,h3{margin:6px 0}
h1{color:var(--primary);font-size:18px;text-align:center}
.card{background:#fff;padding:12px;margin:8px 0;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
label{display:block;margin:6px 0}
input[type="radio"]{margin-right:8px}
.btn{display:inline-block;padding:8px 12px;border-radius:8px;border:none;background:var(--primary);color:#fff;cursor:pointer}
.small{font-size:13px;color:#444}
.flex{display:flex;gap:8px;align-items:center}
#resultChart{width:100%;height:220px;background:#fff;border-radius:8px;padding:8px;box-sizing:border-box}
.historyItem{padding:8px;border-radius:8px;border:1px dashed #eee;margin:6px 0;background:#fbfeff}
.splash{position:fixed;inset:0;background:linear-gradient(135deg,#1565c0,#42a5f5);display:flex;align-items:center;justify-content:center;color:#fff;z-index:9999;flex-direction:column}
.hide{display:none}
.legend{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
.legend span{background:#eef6ff;padding:6px 8px;border-radius:999px;color:var(--primary);font-weight:600;font-size:12px}
.input-inline{display:flex;gap:8px}
.input-inline input{flex:1}
.small-muted{font-size:12px;color:#666}
@media (max-width:420px){ #resultChart{height:260px} }
</style>
</head>
<body>
<div class="splash" id="splash" role="status" aria-live="polite">
  <div style="text-align:center">
    <svg width="80" height="80" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" style="border-radius:16px;background:white;padding:8px">
      <rect rx="18" width="120" height="120" fill="#1565c0"/>
      <g transform="translate(20,18)"><path d="M30 0 L45 40 L15 40 Z" fill="#fff"/><circle cx="30" cy="76" r="18" fill="#fff"/></g>
    </svg>
    <h2>SMA Pancawaluya</h2>
    <p style="opacity:0.95">Tes Gaya Belajar â€” Memuat...</p>
  </div>
</div>

<h1>ðŸ§­ Tes 7 Gaya Belajar</h1>

<div class="card" id="identityCard">
  <h3>Identitas Siswa</h3>
  <div class="input-inline">
    <input id="studentName" placeholder="Nama siswa">
    <input id="studentClass" placeholder="Kelas (contoh: 10 IPA 1)">
  </div>
  <div class="small-muted">Isi nama & kelas sebelum memulai. Data akan tersimpan bersama hasil jika disimpan.</div>
  <div style="margin-top:8px" class="flex">
    <button id="btnStart" class="btn">Mulai Tes</button>
    <button id="btnClearHistory" class="btn" style="background:#ef5350;margin-left:6px">Hapus Riwayat</button>
  </div>
</div>

<div class="card" id="quizCard" style="display:none">
  <h3>Petunjuk</h3>
  <p class="small">Jawab jujur skala 1â€“5 pada tiap pernyataan: 1 = Sangat Tidak Setuju, 5 = Sangat Sangat Setuju. Tes terdiri dari <strong>21 pertanyaan</strong> (3 pertanyaan per gaya belajar).</p>
  <div id="questions"></div>
  <div style="margin-top:8px" class="flex">
    <button id="btnSubmit" class="btn">Hitung & Lihat Hasil</button>
    <button id="btnReset" class="btn" style="background:#ef5350;margin-left:6px">Reset Jawaban</button>
    <button id="btnBack" class="btn" style="background:#777;margin-left:6px">Kembali</button>
  </div>
</div>

<div class="card" id="resultCard" style="display:none">
  <h3>Hasil Tes</h3>
  <div id="dominant" class="small"></div>
  <div id="resultChart" aria-hidden="true"></div>
  <div class="legend" id="legend"></div>
  <div style="margin-top:8px" class="flex">
    <button id="btnSave" class="btn">Simpan Hasil (Nama & Kelas)</button>
    <button id="btnExport" class="btn" style="background:#6a1b9a;margin-left:6px">Ekspor CSV</button>
    <button id="btnShare" class="btn" style="background:#388e3c;margin-left:6px">Bagikan Hasil</button>
  </div>
</div>

<div class="card">
  <h3>Riwayat Hasil</h3>
  <div id="history"></div>
  <div style="margin-top:8px" class="small">Riwayat disimpan di perangkat (localStorage). Hasil tersimpan berisi nama, kelas, waktu, dan skor tiap gaya.</div>
</div>

<footer class="small" style="text-align:center;margin-top:8px">ðŸ’™ SMA Pancawaluya â€” Tes Gaya Belajar</footer>

<script>
/* ===== Konfigurasi gaya & soal (21 soal: 3 per gaya) ===== */
const styles = [
  {key:'visual', label:'Visual', desc:'Kamu lebih mudah belajar lewat gambar, diagram, warna, atau peta konsep.'},
  {key:'auditory', label:'Auditori', desc:'Kamu lebih memahami lewat penjelasan lisan, diskusi, atau rekaman suara.'},
  {key:'kinesthetic', label:'Kinestetik', desc:'Kamu lebih paham dengan praktik, gerak, atau pengalaman langsung.'},
  {key:'reading', label:'Membaca/Tulis', desc:'Kamu belajar terbaik lewat teks, catatan, dan menulis ulang.'},
  {key:'logical', label:'Logis', desc:'Kamu suka pola, sistem, dan penalaran untuk memahami materi.'},
  {key:'social', label:'Sosial', desc:'Kamu termotivasi belajar lewat diskusi kelompok atau teman.'},
  {key:'solitary', label:'Soliter', desc:'Kamu lebih fokus dan efektif saat belajar sendiri.'}
];

const questions = [
  // visual (3)
  {q:'Saya mengerti pelajaran lebih cepat bila ada gambar, diagram, atau peta konsep.', style:'visual'},
  {q:'Saya sering menggunakan warna atau mindmap untuk mengingat materi.', style:'visual'},
  {q:'Saya mudah memahami informasi yang disajikan dalam bentuk visual/slide.', style:'visual'},

  // auditory (3)
  {q:'Saya lebih mudah mengingat jika saya mendengarkan penjelasan atau rekaman.', style:'auditory'},
  {q:'Saya suka belajar dengan berdiskusi atau mengulang materi secara lisan.', style:'auditory'},
  {q:'Saya cepat menangkap informasi bila guru menjelaskannya secara verbal.', style:'auditory'},

  // kinesthetic (3)
  {q:'Saya memahami materi lebih baik bila saya melakukan praktik langsung.', style:'kinesthetic'},
  {q:'Saya suka belajar melalui aktivitas/percobaan atau proyek.', style:'kinesthetic'},
  {q:'Saya sering perlu bergerak atau mencoba sesuatu untuk mengerti konsep.', style:'kinesthetic'},

  // reading/writing (3)
  {q:'Saya lebih mudah ingat setelah menulis rangkuman atau catatan sendiri.', style:'reading'},
  {q:'Saya suka membaca buku atau artikel untuk mempelajari sesuatu.', style:'reading'},
  {q:'Saya sering menyalin poin penting untuk membantu memori saya.', style:'reading'},

  // logical (3)
  {q:'Saya suka mencari pola atau alasan di balik suatu konsep.', style:'logical'},
  {q:'Saya menikmati memecahkan masalah yang membutuhkan penalaran logis.', style:'logical'},
  {q:'Saya belajar lebih baik bila materi dijelaskan dengan urutan logis atau langkah-langkah.', style:'logical'},

  // social (3)
  {q:'Saya merasa lebih termotivasi belajar saat berdiskusi dengan teman.', style:'social'},
  {q:'Saya sering belajar dalam kelompok karena itu membuat saya lebih paham.', style:'social'},
  {q:'Saya suka tugas yang melibatkan kerja tim dan diskusi.', style:'social'},

  // solitary (3)
  {q:'Saya lebih suka belajar sendiri tanpa gangguan.', style:'solitary'},
  {q:'Saya merasa lebih fokus ketika mempelajari materi secara mandiri.', style:'solitary'},
  {q:'Saya lebih nyaman merencanakan dan belajar sendiri daripada dalam kelompok.', style:'solitary'}
];

/* ===== Storage keys ===== */
const RESULTS_KEY = 'gaya_results_v2';

/* ===== Helpers & UI ===== */
const $ = id => document.getElementById(id);
const fmt = v => Number(v).toLocaleString('id-ID');

/* Render questions (but only show after start) */
function renderQuestions(){
  const wrap = $('questions');
  wrap.innerHTML = '';
  questions.forEach((qs, i) => {
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `<strong>Soal ${i+1}.</strong> <span class="small">${qs.q}</span>
      <div style="margin-top:6px" aria-label="skala 1 sampai 5">
        ${[1,2,3,4,5].map(n=>`<label style="margin-right:8px"><input type="radio" name="q${i}" value="${n}"> ${n}</label>`).join('')}
      </div>`;
    wrap.appendChild(div);
  });
}

/* Compute scores */
function computeScores(){
  const scores = {};
  styles.forEach(s=>scores[s.key]=0);
  let answered = 0;
  questions.forEach((qs,i)=>{
    const el = document.querySelector(`input[name="q${i}"]:checked`);
    if(el){ scores[qs.style] += Number(el.value); answered++; }
  });
  return {scores, answered};
}

/* Render bar chart (SVG) */
function renderChart(scores){
  const container = $('resultChart');
  const w = Math.max(300, container.clientWidth - 16);
  const rowH = 26;
  const h = styles.length * rowH + 20;
  const maxScore = Math.max(1, ...Object.values(scores));
  let svg = `<svg width="100%" height="${h}" viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg">`;
  styles.forEach((s, idx)=>{
    const sc = scores[s.key] || 0;
    const barMax = Math.round((w - 160) * (sc / maxScore));
    const y = 10 + idx * rowH;
    svg += `<text x="8" y="${y+16}" font-size="12" fill="#333">${s.label}</text>`;
    svg += `<rect x="120" y="${y+4}" width="${barMax}" height="16" rx="8" fill="#1565c0" />`;
    svg += `<text x="${120 + barMax + 8}" y="${y+16}" font-size="12" fill="#111">${sc}</text>`;
  });
  svg += `</svg>`;
  container.innerHTML = svg;
  $('legend').innerHTML = `<div class="small-muted">Skor maksimum tiap gaya = 15 (3 soal x skor 5)</div>`;
}

/* Show dominant style (and description only for dominant) */
function showResult(scores){
  const entries = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
  const topScore = entries[0][1];
  const tops = entries.filter(e=>e[1]===topScore).map(e=>e[0]);
  const labels = tops.map(t => styles.find(s=>s.key===t).label);
  const descs = tops.map(t => styles.find(s=>s.key===t).desc);
  const dominants = labels.join(', ');
  $('dominant').innerHTML = `<strong>Gaya dominan:</strong> ${dominants} <br><small>${descs.join(' / ')}</small>`;
}

/* History load/save */
function loadHistory(){ const raw = localStorage.getItem(RESULTS_KEY); return raw ? JSON.parse(raw) : []; }
function saveHistoryRecord(name,kelas,scores){
  const hist = loadHistory();
  const rec = {name, kelas, scores, time: new Date().toLocaleString('id-ID')};
  hist.unshift(rec);
  localStorage.setItem(RESULTS_KEY, JSON.stringify(hist.slice(0,50)));
  renderHistory();
}
function renderHistory(){
  const h = loadHistory();
  const wrap = $('history');
  if(h.length===0){ wrap.innerHTML = '<div class="small">Belum ada hasil tersimpan.</div>'; return; }
  wrap.innerHTML = '';
  h.forEach((r, idx)=>{
    const div = document.createElement('div');
    div.className = 'historyItem';
    const top = Object.entries(r.scores).sort((a,b)=>b[1]-a[1])[0];
    const domLabel = styles.find(s=>s.key===top[0]).label;
    div.innerHTML = `<div><strong>${idx+1}. ${r.name} â€” ${r.kelas} â€” ${domLabel}</strong> <span class="small">(${r.time})</span></div>
      <div class="small">Skor: ${styles.map(s=>`${s.label}:${r.scores[s.key]||0}`).join(' | ')}</div>`;
    wrap.appendChild(div);
  });
}

/* Export CSV (history) */
function exportCSV(){
  const hist = loadHistory();
  if(hist.length===0) return alert('Belum ada hasil untuk diekspor.');
  let csv = 'Waktu,Nama,Kelas,' + styles.map(s=>s.label).join(',') + '\n';
  hist.forEach(r=>{
    csv += `"`+r.time+`","`+r.name+`","`+r.kelas+`",` + styles.map(s=>r.scores[s.key]||0).join(',') + '\n';
  });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([csv], {type:'text/csv'}));
  a.download = 'hasil_gaya_belajar.csv';
  a.click();
}

/* Share text */
function shareResult(name,kelas,scores){
  const entries = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
  const top = entries[0];
  const text = `Hasil Tes Gaya Belajar â€” ${name} (${kelas}): ${styles.find(s=>s.key===top[0]).label} (skor ${top[1]}).`;
  if(navigator.share){ navigator.share({title:'Hasil Tes Gaya Belajar', text}); }
  else { prompt('Salin hasil ini untuk dibagikan:', text); }
}

/* Handlers */
$('btnStart').onclick = ()=>{
  const name = $('studentName').value.trim();
  const kelas = $('studentClass').value.trim();
  if(!name || !kelas) return alert('Isi Nama dan Kelas terlebih dahulu.');
  $('identityCard').style.display = 'none';
  $('quizCard').style.display = 'block';
  window.currentStudent = {name, kelas};
  if(!document.querySelectorAll('#questions .card').length) renderQuestions();
  setTimeout(()=>document.getElementById('quizCard').scrollIntoView({behavior:'smooth'}),100);
};

$('btnBack').onclick = ()=>{
  $('quizCard').style.display = 'none';
  $('identityCard').style.display = 'block';
};

$('btnSubmit').onclick = ()=>{
  const {scores, answered} = computeScores();
  if(answered < questions.length) return alert(`Silakan jawab semua ${questions.length} pertanyaan (terjawab ${answered}).`);
  renderChart(scores);
  showResult(scores);
  $('resultCard').style.display = 'block';
  window.latest = {scores, name: window.currentStudent?.name || '', kelas: window.currentStudent?.kelas || ''};
  setTimeout(()=>document.getElementById('resultCard').scrollIntoView({behavior:'smooth'}),200);
};

$('btnSave').onclick = ()=>{
  if(!window.latest || !window.latest.scores) return alert('Belum ada hasil untuk disimpan. Tekan "Hitung & Lihat Hasil" dulu.');
  const name = window.latest.name || $('studentName').value.trim();
  const kelas = window.latest.kelas || $('studentClass').value.trim();
  if(!name || !kelas) return alert('Nama dan Kelas diperlukan untuk menyimpan hasil.');
  saveHistoryRecord(name, kelas, window.latest.scores);
  alert('Hasil disimpan.');
};

$('btnExport').onclick = exportCSV;
$('btnShare').onclick = ()=>{
  if(!window.latest) return alert('Belum ada hasil untuk dibagikan.');
  shareResult(window.latest.name, window.latest.kelas, window.latest.scores);
};

$('btnReset').onclick = ()=>{
  document.querySelectorAll('input[type=radio]').forEach(r=>r.checked=false);
  $('resultCard').style.display='none';
  window.latest = null;
};

$('btnClearHistory').onclick = ()=>{
  if(!confirm('Hapus semua riwayat hasil?')) return;
  localStorage.removeItem(RESULTS_KEY);
  renderHistory();
  alert('Riwayat dihapus.');
};

window.addEventListener('load', ()=>{
  renderQuestions(); renderHistory();
  setTimeout(()=>{ const s=document.getElementById('splash'); if(s){ s.classList.add('hide'); s.style.display='none'; } }, 700);
  if('serviceWorker' in navigator){
    const swCode = `
      const CACHE_NAME='gaya-belajar-pwa-vfinal-1';
      const FILES=['./'];
      self.addEventListener('install', e=>{ e.waitUntil(caches.open(CACHE_NAME).then(c=>c.addAll(FILES))); });
      self.addEventListener('activate', e=>{ e.waitUntil(self.clients.claim()); });
      self.addEventListener('fetch', e=>{ e.respondWith(caches.match(e.request).then(res=>res||fetch(e.request)).catch(()=>caches.match('./'))); });
    `;
    const blob = new Blob([swCode], {type:'text/javascript'});
    const swUrl = URL.createObjectURL(blob);
    navigator.serviceWorker.register(swUrl).then(()=>console.log('SW registered final')).catch(err=>console.warn('SW failed',err));
  }
});
</script>
</body>
</html>
